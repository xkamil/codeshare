<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>codeshare</title>
    <script src="script/codeflas.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<a href="/">join new room</a>
<div id="editor"></div>
</body>


</html>

<script>
  const room = window.location.pathname.replace("/", "");
  const socket = window.io();
  const flask = new CodeFlask('#editor', {language: 'js', lineNumbers: true});
  let needUpdate = false;

  socket.emit('join_room', room);

  flask.onUpdate(newContent => {
    needUpdate = true
  })

  setInterval(
    () => {
      if (needUpdate) {
        socket.emit('content_updated', flask.getCode());
        needUpdate = false;
      }

    }, 500
  );

  socket.on('content_updated', newContent => {
    flask.updateCode(newContent);
  })

</script>